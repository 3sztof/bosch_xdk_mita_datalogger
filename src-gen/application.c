/**
 * Generated by Eclipse Mita 0.1.0.
 * @date 2019-05-23 19:47:53
 */


#include <bma2x2.h>
#include <inttypes.h>
#include <stdio.h>
#include <BCDS_Basics.h>
#include <BCDS_Retcode.h>
#include <string.h>
#include <stdint.h>
#include <stdbool.h>
#include "SensorAccelerometer.h"
#include "PlatformXDK110.h"
#include "xdk110Types.h"
#include "InputOutputSDCardSd.h"
#include "ConnectivityLEDLed.h"
#include "MitaExceptions.h"
#include "application.h"
#include <stdlib.h>

#ifndef BCDS_MODULE_ID
#define BCDS_MODULE_ID 0xCAFE
#endif

bool inactive = true;
int32_t cycle = 0;
char sCycle_buf[2] = {0};
char *sCycle = sCycle_buf;
bool orangeBlink = 0;
bool orangeOn = false;
int32_t orangeBlinksRequested = 0;
int32_t blinkCounter = 0;
int32_t accelerationX = 0;
int32_t accelerationY = 0;
int32_t accelerationZ = 0;

Retcode_T initGlobalVariables_application() {
	Retcode_T exception = RETCODE_OK;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	if(exception != NO_EXCEPTION) return exception;
	
	return exception;
}

Retcode_T HandleEveryXDK110Startup1(void* userParameter1, uint32_t userParameter2)
{
	
	BCDS_UNUSED(userParameter1);
	BCDS_UNUSED(userParameter2);

	Retcode_T exception = NO_EXCEPTION;
	
	
	bool _newConnectivityLEDLed_Red_1 = true;
	exception = ConnectivityLEDLed_Red_Write(&_newConnectivityLEDLed_Red_1);
	if(exception != NO_EXCEPTION) return exception;
	char* _newInputOutputSDCardSd_CycleInit_2 = "x";
	exception = InputOutputSDCardSd_CycleInit_Write(&_newInputOutputSDCardSd_CycleInit_2);
	if(exception != NO_EXCEPTION) return exception;
	char result2004107718_buf[16] = {0};
	char *result2004107718 = result2004107718_buf;
	
	char mainHandleEveryXDK110Startup11Result2004107718_2_buf[16] = {0};
	snprintf(mainHandleEveryXDK110Startup11Result2004107718_2_buf, sizeof(mainHandleEveryXDK110Startup11Result2004107718_2_buf), "XDK power on \n");
	memcpy(result2004107718, mainHandleEveryXDK110Startup11Result2004107718_2_buf, sizeof(mainHandleEveryXDK110Startup11Result2004107718_2_buf));
	
	char* _newInputOutputSDCardSd_Writer_3 = result2004107718;
	exception = InputOutputSDCardSd_Writer_Write(&_newInputOutputSDCardSd_Writer_3);
	if(exception != NO_EXCEPTION) return exception;


	return NO_EXCEPTION;
}

Retcode_T HandleEveryButton_onePressed1(void* userParameter1, uint32_t userParameter2)
{
	
	BCDS_UNUSED(userParameter1);
	BCDS_UNUSED(userParameter2);

	Retcode_T exception = NO_EXCEPTION;
	
	
	if(inactive)
	{
		PowerStatus platformXDK110ModalityPreparation_1;
		exception = XDK110_powerStatus_read(&platformXDK110ModalityPreparation_1);
		if(exception != NO_EXCEPTION) return exception;
		
		PowerStatus ps;
		ps = platformXDK110ModalityPreparation_1;
		switch(ps.tag) {
			case PowerStatus_Battery_e: {
				float level = ps.data.Battery;
				
					char result485666679_buf[42] = {0};
					char *result485666679 = result485666679_buf;
					
					char IsDeconstructionCase0Result485666679_3_buf[42] = {0};
					snprintf(IsDeconstructionCase0Result485666679_3_buf, sizeof(IsDeconstructionCase0Result485666679_3_buf), "Battery level: approx. %.6g%% \n", level);
					memcpy(result485666679, IsDeconstructionCase0Result485666679_3_buf, sizeof(IsDeconstructionCase0Result485666679_3_buf));
					
					char* _newInputOutputSDCardSd_Writer_1 = result485666679;
					exception = InputOutputSDCardSd_Writer_Write(&_newInputOutputSDCardSd_Writer_1);
					if(exception != NO_EXCEPTION) return exception;
				
				break;
			}
			case PowerStatus_Corded_e: {
				
					char result710034152_buf[42] = {0};
					char *result710034152 = result710034152_buf;
					
					char IsTypeMatchCase0Result710034152_5_buf[42] = {0};
					snprintf(IsTypeMatchCase0Result710034152_5_buf, sizeof(IsTypeMatchCase0Result710034152_5_buf), "Battery level: USB connected, charging \n");
					memcpy(result710034152, IsTypeMatchCase0Result710034152_5_buf, sizeof(IsTypeMatchCase0Result710034152_5_buf));
					
					char* _newInputOutputSDCardSd_Writer_2 = result710034152;
					exception = InputOutputSDCardSd_Writer_Write(&_newInputOutputSDCardSd_Writer_2);
					if(exception != NO_EXCEPTION) return exception;
				
				break;
			}
		}
		
		char result1566350062_buf[2] = {0};
		char *result1566350062 = result1566350062_buf;
		
		exception = InputOutputSDCardSd_CycleReader_Read(&result1566350062);
		if(exception != NO_EXCEPTION) return exception;
		
		memcpy(sCycle, result1566350062, sizeof(result1566350062_buf));
		if(sCycle == "x")
		{
			char* _newInputOutputSDCardSd_CycleWriter_4 = "1";
			exception = InputOutputSDCardSd_CycleWriter_Write(&_newInputOutputSDCardSd_CycleWriter_4);
			if(exception != NO_EXCEPTION) return exception;
			cycle = 1;
		}
		
		cycle += 1;
		char result2147310613_buf[39] = {0};
		char *result2147310613 = result2147310613_buf;
		
		char IfStatement1Result2147310613_7_buf[39] = {0};
		snprintf(IfStatement1Result2147310613_7_buf, sizeof(IfStatement1Result2147310613_7_buf), "Data acquisition cycle: %" PRId32 " \n", cycle);
		memcpy(result2147310613, IfStatement1Result2147310613_7_buf, sizeof(IfStatement1Result2147310613_7_buf));
		
		char* _newInputOutputSDCardSd_Writer_5 = result2147310613;
		exception = InputOutputSDCardSd_Writer_Write(&_newInputOutputSDCardSd_Writer_5);
		if(exception != NO_EXCEPTION) return exception;
		char result1441913117_buf[49] = {0};
		char *result1441913117 = result1441913117_buf;
		
		char IfStatement1Result1441913117_8_buf[49] = {0};
		snprintf(IfStatement1Result1441913117_8_buf, sizeof(IfStatement1Result1441913117_8_buf), "X [raw] ; Y [raw] ; Z [raw] ; cycle time [ms] \n");
		memcpy(result1441913117, IfStatement1Result1441913117_8_buf, sizeof(IfStatement1Result1441913117_8_buf));
		
		char* _newInputOutputSDCardSd_Writer_6 = result1441913117;
		exception = InputOutputSDCardSd_Writer_Write(&_newInputOutputSDCardSd_Writer_6);
		if(exception != NO_EXCEPTION) return exception;
		bool _newConnectivityLEDLed_Red_7 = false;
		exception = ConnectivityLEDLed_Red_Write(&_newConnectivityLEDLed_Red_7);
		if(exception != NO_EXCEPTION) return exception;
		bool _newConnectivityLEDLed_Yellow_8 = true;
		exception = ConnectivityLEDLed_Yellow_Write(&_newConnectivityLEDLed_Yellow_8);
		if(exception != NO_EXCEPTION) return exception;
		inactive = false;
	}
	else
	{
		char result1837929545_buf[32] = {0};
		char *result1837929545 = result1837929545_buf;
		
		char IfStatement104Result1837929545_9_buf[32] = {0};
		snprintf(IfStatement104Result1837929545_9_buf, sizeof(IfStatement104Result1837929545_9_buf), "Data acquisition stopped \n\n\n");
		memcpy(result1837929545, IfStatement104Result1837929545_9_buf, sizeof(IfStatement104Result1837929545_9_buf));
		
		char* _newInputOutputSDCardSd_Writer_9 = result1837929545;
		exception = InputOutputSDCardSd_Writer_Write(&_newInputOutputSDCardSd_Writer_9);
		if(exception != NO_EXCEPTION) return exception;
		bool _newConnectivityLEDLed_Red_10 = true;
		exception = ConnectivityLEDLed_Red_Write(&_newConnectivityLEDLed_Red_10);
		if(exception != NO_EXCEPTION) return exception;
		bool _newConnectivityLEDLed_Yellow_11 = false;
		exception = ConnectivityLEDLed_Yellow_Write(&_newConnectivityLEDLed_Yellow_11);
		if(exception != NO_EXCEPTION) return exception;
		inactive = true;
	}


	return NO_EXCEPTION;
}

Retcode_T HandleEveryButton_twoPressed1(void* userParameter1, uint32_t userParameter2)
{
	
	BCDS_UNUSED(userParameter1);
	BCDS_UNUSED(userParameter2);

	Retcode_T exception = NO_EXCEPTION;
	
	
	printf("Data acquisition cycle: %" PRId32 "\n", cycle);
	orangeBlinksRequested = cycle;
	orangeBlink = true;


	return NO_EXCEPTION;
}

Retcode_T HandleEvery10Millisecond1(void* userParameter1, uint32_t userParameter2)
{
	
	BCDS_UNUSED(userParameter1);
	BCDS_UNUSED(userParameter2);

	Retcode_T exception = NO_EXCEPTION;
	
	
	if(!inactive)
	{
		struct bma2x2_accel_data sensorAccelerometerModalityPreparation_1;
		exception = SensorAccelerometer_ReadXYZ(&sensorAccelerometerModalityPreparation_1);
		if(exception != NO_EXCEPTION) return exception;
		
		accelerationX = sensorAccelerometerModalityPreparation_1.x;
		accelerationY = sensorAccelerometerModalityPreparation_1.y;
		accelerationZ = sensorAccelerometerModalityPreparation_1.z;
		char result2013556761_buf[43] = {0};
		char *result2013556761 = result2013556761_buf;
		
		char IfStatement2Result2013556761_2_buf[43] = {0};
		snprintf(IfStatement2Result2013556761_2_buf, sizeof(IfStatement2Result2013556761_2_buf), "%" PRId32 " ; %" PRId32 " ; %" PRId32 " \n", accelerationX, accelerationY, accelerationZ);
		memcpy(result2013556761, IfStatement2Result2013556761_2_buf, sizeof(IfStatement2Result2013556761_2_buf));
		
		char* _newInputOutputSDCardSd_Writer_1 = result2013556761;
		exception = InputOutputSDCardSd_Writer_Write(&_newInputOutputSDCardSd_Writer_1);
		if(exception != NO_EXCEPTION) return exception;
	}


	return NO_EXCEPTION;
}

Retcode_T HandleEvery200Millisecond1(void* userParameter1, uint32_t userParameter2)
{
	
	BCDS_UNUSED(userParameter1);
	BCDS_UNUSED(userParameter2);

	Retcode_T exception = NO_EXCEPTION;
	
	
	if(orangeBlink)
	{
		if(orangeBlinksRequested > blinkCounter)
		{
			if(!orangeOn)
			{
				bool _newConnectivityLEDLed_Orange_1 = true;
				exception = ConnectivityLEDLed_Orange_Write(&_newConnectivityLEDLed_Orange_1);
				if(exception != NO_EXCEPTION) return exception;
				orangeOn = true;
			}
			else
			{
				bool _newConnectivityLEDLed_Orange_2 = false;
				exception = ConnectivityLEDLed_Orange_Write(&_newConnectivityLEDLed_Orange_2);
				if(exception != NO_EXCEPTION) return exception;
				orangeOn = false;
				blinkCounter += 1;
			}
		}
		else
		{
			blinkCounter = 0;
			orangeBlink = false;
			orangeBlinksRequested = 0;
		}
	}


	return NO_EXCEPTION;
}


